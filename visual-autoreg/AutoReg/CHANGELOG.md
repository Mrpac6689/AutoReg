# Changelog - AutoReg Visual

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AutoReg - Interface GrÃ¡fica                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚                                          â”‚
â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â”‚
â”‚   â•‘   ğŸŒ Navegador Embutido      â•‘   â”‚   â•‘   ğŸ“Š Planilha de Dados         â•‘    â”‚
â”‚   â•‘   (QWebEngineView)           â•‘   â”‚   â•‘   (EditÃ¡vel)                   â•‘    â”‚
â”‚   â•‘                              â•‘   â”‚   â•‘                                â•‘    â”‚
â”‚   â•‘   Exibe pÃ¡ginas SISREG/GHOSPâ•‘   â”‚   â•‘  CÃ³digo â”‚ Paciente â”‚ Data ...  â•‘    â”‚
â”‚   â•‘   durante automaÃ§Ã£o          â•‘   â”‚   â•‘  â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€...  â•‘    â”‚
â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚   â•‘  001   â”‚ JoÃ£o     â”‚ 15/11 ... â•‘    â”‚
â”‚                                      â”‚   â•‘  002   â”‚ Maria    â”‚ 16/11 ... â•‘    â”‚
â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚   â•‘                                â•‘    â”‚
â”‚   â•‘  ğŸ“Ÿ Console de Logs          â•‘   â”‚   â•‘  [â• Linha] [â– Linha]         â•‘    â”‚
â”‚   â•‘  âœ… Iniciando processo...    â•‘   â”‚   â•‘  [â• Col]   [â– Col]           â•‘    â”‚
â”‚   â•‘  â³ Processando dados...     â•‘   â”‚   â•‘  [ğŸ’¾ Salvar] [ğŸ“¤ Exportar]    â•‘    â”‚
â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                      â”‚                                          â”‚
â”‚   ğŸ”§ Selecione a FunÃ§Ã£o AutoReg:    â”‚                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                          â”‚
â”‚   â”‚ extrai_codigos_internacao  â–¼â”‚   â”‚                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                          â”‚
â”‚                                      â”‚                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                          â”‚
â”‚   â”‚ â–¶ï¸ Executar FunÃ§Ã£o Selecionadaâ”‚   â”‚                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

# Changelog - AutoReg Visual

## [18/11/2025] - IntegraÃ§Ã£o Completa com AutoReg Real

### ğŸ¯ ATUALIZAÃ‡ÃƒO MAJOR: ExecuÃ§Ã£o Real das FunÃ§Ãµes

A aplicaÃ§Ã£o agora **executa as funÃ§Ãµes reais** do sistema AutoReg original, com:
- **Redirecionamento de stdout/stderr** para o console de logs
- **Captura do navegador Selenium** e sincronizaÃ§Ã£o com QWebEngineView
- **DetecÃ§Ã£o automÃ¡tica de CSVs** gerados pelas funÃ§Ãµes
- **Tratamento de erros** robusto com traceback completo

#### ğŸ”§ Sistema de Captura de Driver
- **DriverCapture**: Intercepta instÃ¢ncias do WebDriver do Selenium
- **Monitoramento de URL**: Atualiza o navegador embutido em tempo real
- **IntegraÃ§Ã£o transparente**: FunÃ§Ãµes originais rodam sem modificaÃ§Ãµes

#### ğŸ“Ÿ Redirecionamento de I/O
- **OutputRedirector**: Captura `print()` e `logging` para a GUI
- **Auto-scroll**: Console sempre mostra as mensagens mais recentes
- **PreservaÃ§Ã£o de stdout/stderr**: Restaurados apÃ³s execuÃ§Ã£o

### âœ¨ Funcionalidades Anteriores

## [18/11/2025] - Widget de Planilhas e Dropdown de FunÃ§Ãµes

### âœ¨ Novas Funcionalidades

#### ğŸ”½ Dropdown de FunÃ§Ãµes AutoReg
- **LocalizaÃ§Ã£o**: Acima do botÃ£o "Executar", no painel esquerdo
- **Funcionalidades**:
  - ğŸ“‹ Lista completa com 33 funÃ§Ãµes disponÃ­veis do sistema AutoReg
  - ğŸ¨ Interface estilizada com cores e Ã­cones
  - ğŸ”„ Desabilitado durante execuÃ§Ã£o para evitar conflitos
  - âš¡ SeleÃ§Ã£o dinÃ¢mica da funÃ§Ã£o a ser executada
- **FunÃ§Ãµes DisponÃ­veis**:
  - ExtraÃ§Ã£o: `extrai_codigos_internacao`, `extrai_internados_sisreg`, `extrai_internados_ghosp`, etc.
  - InternaÃ§Ã£o: `interna_pacientes`, `compara_internados`
  - Alta: `motivo_alta`, `executa_alta`, `dar_alta`, `trata_altas`
  - SolicitaÃ§Ãµes: `solicita_sisreg`, `solicita_nota`, `solicita_inf_aih`, `solicita_pre_aih`
  - G-HOSP: `ghosp_nota`, `ghosp_cns`, `ghosp_especial`, `internados_ghosp_avancado`
  - ProduÃ§Ã£o: `producao_ambulatorial`, `producao_ambulatorial_dados`, `producao_ambulatorial_gmus`
  - Utilidades: `pdf2csv`, `limpa_cache`, `devolvidos`

### âœ¨ Funcionalidades Anteriores

#### ğŸ—‚ï¸ Widget de Planilhas
- **LocalizaÃ§Ã£o**: Painel direito da interface principal
- **Funcionalidades**:
  - âœï¸ EdiÃ§Ã£o de cÃ©lulas em tempo real
  - â• Adicionar/remover linhas e colunas
  - ğŸ’¾ Salvar alteraÃ§Ãµes no arquivo original
  - ğŸ“¤ Exportar para novo arquivo CSV
  - ğŸ—‘ï¸ Limpar toda a planilha
  - ğŸ–±ï¸ Menu de contexto (botÃ£o direito)
  - ğŸ¨ Cores alternadas nas linhas para melhor legibilidade
  - ğŸ“Š Redimensionamento automÃ¡tico de colunas

#### ğŸ”„ IntegraÃ§Ã£o AutomÃ¡tica
- Ao finalizar uma rotina, o CSV gerado Ã© **automaticamente carregado** no widget de planilhas
- Console de logs mostra o caminho do arquivo gerado
- BotÃ£o "Iniciar Exemplo" desabilitado durante processamento

#### ğŸ¨ Layout Aprimorado
- **Splitter Horizontal**: Divide a interface em duas Ã¡reas redimensionÃ¡veis
  - **Esquerda** (60%): Navegador + Console de Logs + BotÃµes
  - **Direita** (40%): Widget de Planilhas
- Layout responsivo e ajustÃ¡vel pelo usuÃ¡rio

### ğŸ¯ Fluxo de Uso

1. **Selecionar FunÃ§Ã£o**: Escolha uma das 33 funÃ§Ãµes disponÃ­veis no dropdown
2. **Executar**: Clique no botÃ£o "â–¶ï¸ Executar FunÃ§Ã£o Selecionada"
3. **Acompanhar**: Veja o progresso no console de logs
4. **Visualizar**: O CSV gerado aparece automaticamente na planilha Ã  direita
5. **Editar**: Modifique os dados diretamente na planilha
6. **Salvar**: Use os botÃµes da toolbar para salvar ou exportar

### ğŸ“ Arquivos da IntegraÃ§Ã£o Real

1. **`src/workers/thread_worker.py`** (REESCRITO)
   - Classe `OutputRedirector` para capturar stdout/stderr
   - IntegraÃ§Ã£o com `DriverCapture` para capturar Selenium
   - MÃ©todo `execute_autoreg_function()` executa funÃ§Ãµes reais
   - Monitoramento de URL com `check_driver_url()`
   - Busca automÃ¡tica de CSVs em mÃºltiplos diretÃ³rios
   - Tratamento de exceÃ§Ãµes com traceback completo

2. **`src/core/driver_capture.py`** (NOVO)
   - Intercepta criaÃ§Ã£o de instÃ¢ncias WebDriver
   - MantÃ©m lista de drivers ativos
   - Permite acesso ao driver mais recente
   - Restaura comportamento original apÃ³s uso

3. **`src/core/selenium_integration.py`** (NOVO)
   - FunÃ§Ãµes auxiliares para integraÃ§Ã£o Selenium+Qt
   - Classe `SeleniumMonitor` para sincronizaÃ§Ã£o
   - OpÃ§Ãµes customizadas de Chrome para debug remoto
   - (Preparado para expansÃµes futuras)

4. **`src/ui/main_window.py`** (MODIFICADO)
   - Conecta sinal `url_changed` ao navegador
   - MÃ©todo `update_browser_url()` sincroniza QWebEngineView
   - MÃ©todo `handle_error()` exibe mensagens de erro
   - Auto-scroll no console de logs
   - Tratamento de erros com QMessageBox

5. **`run.sh`** (MODIFICADO)
   - PYTHONPATH inclui raiz do autoreg
   - Permite importaÃ§Ã£o do mÃ³dulo `autoreg`

### ğŸ“ Arquivos Anteriores

1. **`src/ui/main_window.py`** (MODIFICADO ANTERIORMENTE)
   - Adicionado QComboBox com todas as funÃ§Ãµes do autoreg
   - MÃ©todo `get_autoreg_functions()` retorna lista de 33 funÃ§Ãµes
   - EstilizaÃ§Ã£o CSS para ComboBox e botÃ£o
   - Label descritivo "ğŸ› ï¸ Selecione a FunÃ§Ã£o AutoReg"
   - Desabilita combo durante execuÃ§Ã£o

2. **`src/workers/thread_worker.py`** (MODIFICADO)
   - Atributo `selected_function` para armazenar funÃ§Ã£o escolhida
   - Nome do CSV gerado inclui nome da funÃ§Ã£o
   - Logs dinÃ¢micos baseados na funÃ§Ã£o selecionada

3. **`src/ui/spreadsheet_widget.py`** (NOVO)
   - Widget completo de planilhas com QTableWidget
   - Toolbar com botÃµes de aÃ§Ã£o
   - Suporte a CSV com encoding UTF-8
   - Menu de contexto com atalhos

4. **`src/ui/spreadsheet_widget.py`** (ANTERIOR)
   - Widget de planilhas com QTableWidget
   - Toolbar com botÃµes de aÃ§Ã£o
   - Suporte a CSV com encoding UTF-8
   - Menu de contexto com atalhos

### ğŸš€ Como Usar

1. **Executar a aplicaÃ§Ã£o**:
   ```bash
   cd /home/michel/code/AutoReg/visual-autoreg/AutoReg
   source /home/michel/code/AutoReg/venv/bin/activate
   PYTHONPATH=/home/michel/code/AutoReg/visual-autoreg/AutoReg/src python3 src/main.py
   ```

2. **Fluxo de trabalho**:
   - Clique em "Iniciar Exemplo"
   - Aguarde o processamento (logs aparecem no console)
   - O CSV Ã© automaticamente carregado no painel direito
   - Edite as cÃ©lulas diretamente clicando nelas
   - Use os botÃµes da toolbar para manipular dados
   - Salve as alteraÃ§Ãµes com o botÃ£o "ğŸ’¾ Salvar"

3. **Atalhos e Recursos**:
   - **BotÃ£o Direito** â†’ Menu de contexto com aÃ§Ãµes rÃ¡pidas
   - **â• Linha/Coluna** â†’ Adiciona apÃ³s a seleÃ§Ã£o atual
   - **â– Linha/Coluna** â†’ Remove a seleÃ§Ã£o atual
   - **ğŸ“¤ Exportar** â†’ Salva em novo arquivo
   - **ğŸ—‘ï¸ Limpar** â†’ Remove todos os dados (com confirmaÃ§Ã£o)

### ğŸ“‚ Estrutura de SaÃ­da

Os CSVs gerados sÃ£o salvos em:
```
visual-autoreg/AutoReg/output/
â”œâ”€â”€ codigos_internacao_20251118_143022.csv
â”œâ”€â”€ codigos_internacao_20251118_143155.csv
â””â”€â”€ ...
```

### ğŸ”§ DependÃªncias

Nenhuma nova dependÃªncia foi adicionada. O projeto continua usando:
- PyQt6
- PyQt6-WebEngine

### ğŸ¯ PrÃ³ximos Passos

- [ ] Integrar com as funÃ§Ãµes reais do `autoreg.py`
- [ ] Adicionar validaÃ§Ã£o de dados nas cÃ©lulas
- [ ] Implementar filtros e ordenaÃ§Ã£o de colunas
- [ ] Adicionar exportaÃ§Ã£o para outros formatos (Excel, JSON)
- [ ] Implementar busca/substituiÃ§Ã£o em massa
- [ ] Adicionar formataÃ§Ã£o condicional
